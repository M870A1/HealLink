<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>HealLink - 관리자 공지사항</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">

    <!--  공용 CSS : 글로벌, 헤더, 푸터, 본문  2026-01-20 -->
    <link rel="stylesheet" th:href="@{/css/global.css}">
    <link rel="stylesheet" th:href="@{/css/mainpage/header.css}">
    <link rel="stylesheet" th:href="@{/css/mainpage/footer.css}">
    <link rel="stylesheet" th:href="@{/css/mainpage/content.css}">

    <style>
        /* 1. 제목 굵기 고정 (우리가 맞췄던 그 설정!) */
        .notice-header h3 {
            font-weight: 700 !important;
            font-size: 2.2rem !important;
            color: #153f8f !important;
            margin-bottom: 30px;
        }

        /* 2. 테이블 스타일 세련되게 */
        .table thead th {
            background-color: #f8f9fa;
            border-top: 2px solid #153f8f; /* 헤더 상단 포인트 컬러 */
            color: #333;
            font-weight: 600;
        }
        .table td { vertical-align: middle; }

        /* 3. 고정 공지사항 강조 */
        .pinned-row { background-color: #fff9f0; }
        .badge-pinned { background-color: #d9480f; color: white; padding: 4px 8px; font-size: 11px; }

        /* 4. 페이지네이션 커스텀 */
        .pagination .page-link { color: #153f8f; }
        .pagination .page-item.active .page-link {
            background-color: #153f8f;
            border-color: #153f8f;
            color: white;
        }

        /* 5. 검색창 정렬 */
        .search-container {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
    </style>
</head>
<body>

<div th:replace="~{mainpage/header :: header}"></div>

<div class="container mt-5" style="min-height: 700px;">

    <div class="notice-header">
        <h3>공지사항 관리</h3>
    </div>

    <div class="search-container">
        <form action="/admin/notice" method="get" id="searchForm" class="form-inline justify-content-center">
            <input type="hidden" name="page" value="1">

            <select name="types" class="form-control mr-2">
                <option value="tc" th:selected="${responseDTO.pageRequestDTO.types == 'tc'}">제목 + 내용</option>
                <option value="t" th:selected="${responseDTO.pageRequestDTO.types == 't'}">제목</option>
                <option value="c" th:selected="${responseDTO.pageRequestDTO.types == 'c'}">내용</option>
            </select>

            <input type="text" name="keyword" class="form-control mr-2" style="width: 300px;"
                   th:value="${responseDTO.pageRequestDTO.keyword}" placeholder="검색어를 입력하세요">

            <button type="submit" class="btn btn-primary px-4">검색</button>
            <button type="button" class="btn btn-outline-secondary ml-2" onclick="location.href='/admin/notice'">초기화</button>
        </form>
    </div>

    <div class="table-responsive">
        <table class="table table-hover">
            <thead class="text-center">
            <tr>
                <th style="width: 80px;">번호</th>
                <th>제목</th>
                <th style="width: 120px;">작성자</th>
                <th style="width: 80px;">조회수</th>
                <th style="width: 160px;">작성일</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="notice : ${responseDTO.pinnedList}" class="pinned-row">
                <td class="text-center"><span class="badge badge-pinned">공지</span></td>
                <td>
                    <a th:href="@{/admin/notice/{id}(id=${notice.noticeId}, page=${responseDTO.pageRequestDTO.page}, types=${responseDTO.pageRequestDTO.types}, keyword=${responseDTO.pageRequestDTO.keyword})}"
                       th:text="${notice.title}" class="font-weight-bold text-dark">고정된 제목</a>
                </td>
                <td class="text-center" th:text="${notice.writerName}">작성자</td>
                <td class="text-center" th:text="${notice.viewCount}">0</td>
                <td class="text-center" th:text="${#temporals.format(notice.createdAt, 'yyyy-MM-dd')}">날짜</td>
            </tr>

            <tr th:each="notice : ${responseDTO.dtoList}">
                <td class="text-center" th:text="${notice.noticeId}">1</td>
                <td>
                    <a th:href="@{/admin/notice/{id}(id=${notice.noticeId}, page=${responseDTO.pageRequestDTO.page}, types=${responseDTO.pageRequestDTO.types}, keyword=${responseDTO.pageRequestDTO.keyword})}"
                       th:text="${notice.title}" class="text-dark">일반 제목</a>
                </td>
                <td class="text-center" th:text="${notice.writerName}">작성자</td>
                <td class="text-center" th:text="${notice.viewCount}">0</td>
                <td class="text-center" th:text="${#temporals.format(notice.createdAt, 'yyyy-MM-dd')}">날짜</td>
            </tr>

            <tr th:if="${#lists.isEmpty(responseDTO.dtoList) && #lists.isEmpty(responseDTO.pinnedList)}">
                <td colspan="5" class="text-center py-5 text-muted">등록된 공지사항이 없습니다.</td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="text-right mt-3" sec:authorize="hasRole('ADMIN')">
        <button type="button" class="btn btn-primary shadow-sm" th:onclick="checkLoginAndRedirect()">+ 공지사항 등록</button>
    </div>

    <nav aria-label="Page navigation" class="mt-5">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:if="${responseDTO.prev}">
                <a class="page-link" th:href="|@{/admin/notice}${responseDTO.pageRequestDTO.getLink(responseDTO.start - 1)}|">이전</a>
            </li>

            <th:block th:each="num : ${#numbers.sequence(responseDTO.start, responseDTO.end)}">
                <li th:class="|page-item ${responseDTO.page == num ? 'active' : ''}|">
                    <a class="page-link" th:href="|@{/admin/notice}${responseDTO.pageRequestDTO.getLink(num)}|" th:text="${num}">1</a>
                </li>
            </th:block>

            <li class="page-item" th:if="${responseDTO.next}">
                <a class="page-link" th:href="|@{/admin/notice}${responseDTO.pageRequestDTO.getLink(responseDTO.end + 1)}|">다음</a>
            </li>
        </ul>
    </nav>
</div>

<div th:replace="~{mainpage/footer :: footer}"></div>

<script th:inline="javascript">
    function checkLoginAndRedirect() {
        const isAuthenticated = [[${#authorization.expression('isAuthenticated()')}]];
        if (!isAuthenticated) {
            alert("로그인이 필요한 서비스입니다.");
            location.href = '/login';
        } else {
            location.href = '/admin/notice/create';
        }
    }
</script>

</body>
</html>