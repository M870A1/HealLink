<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>HealLink - 공지사항 수정</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!--  공용 CSS : 글로벌, 헤더, 푸터, 본문  2026-01-20 -->
    <link rel="stylesheet" th:href="@{/css/global.css}">
    <link rel="stylesheet" th:href="@{/css/mainpage/header.css}">
    <link rel="stylesheet" th:href="@{/css/mainpage/footer.css}">
    <link rel="stylesheet" th:href="@{/css/mainpage/content.css}">

    <style>
        .edit-container { max-width: 800px; margin: 50px auto; min-height: 600px; }
        /* 메인 페이지와 통일한 굵은 제목 */
        .edit-title {
            font-weight: 700 !important;
            color: #153f8f !important;
            font-size: 2.2rem !important;
            margin-bottom: 30px;
        }
        .form-label { font-weight: 600; color: #444; }
        .btn-update { background-color: #153f8f; color: white; border: none; }
        .btn-update:hover { background-color: #0d2a63; color: white; }
    </style>
</head>
<body>

<div th:replace="~{mainpage/header :: header}"></div>

<div class="container edit-container">
    <th:block th:if="${#authentication.name == notice.writerEmail}">
        <h3 class="edit-title">공지사항 수정</h3>
        <hr>

        <input type="hidden" id="noticeId" th:value="${notice.noticeId}">

        <div class="form-group">
            <label for="title" class="form-label">제목</label>
            <input type="text" id="title" class="form-control form-control-lg" th:value="${notice.title}">
        </div>

        <div class="form-group custom-control custom-checkbox mb-3">
            <input type="checkbox" class="custom-control-input" id="isPinned" th:checked="${notice.isPinned}">
            <label class="custom-control-label" for="isPinned">이 공지사항을 상단에 고정합니다.</label>
        </div>

        <div class="form-group">
            <label for="content" class="form-label">내용</label>
            <textarea id="content" class="form-control" rows="12" th:text="${notice.content}"></textarea>
        </div>

        <div class="d-flex justify-content-between mt-4">
            <button type="button" class="btn btn-outline-secondary px-4" onclick="history.back()">취소</button>
            <button type="button" class="btn btn-update px-5" onclick="updateNotice()">수정 완료</button>
        </div>
    </th:block>

    <th:block th:unless="${#authentication.name == notice.writerEmail}">
        <div class="text-center py-5">
            <h4 class="text-danger">접근 권한이 없습니다.</h4>
            <p>본인이 작성한 글만 수정할 수 있습니다.</p>
            <button class="btn btn-primary" onclick="location.href='/admin/notice'">목록으로 돌아가기</button>
        </div>
    </th:block>
</div>

<div th:replace="~{mainpage/footer :: footer}"></div>


<script th:inline="javascript">
    function updateNotice() {
        const id = document.getElementById('noticeId').value;

        const requestData = {
            title: document.getElementById('title').value,
            content: document.getElementById('content').value,
            isPinned: document.getElementById('isPinned').checked
        };

        if (!requestData.title.trim() || !requestData.content.trim()) {
            alert("제목과 내용을 모두 입력해주세요.");
            return;
        }

        // Axios PUT 요청
        axios.put('/api/admin/notice/' + id, requestData)
            .then(response => {
                alert("성공적으로 수정되었습니다.");
                location.href = '/admin/notice/' + id;
            })
            .catch(error => {
                console.error("수정 실패:", error);
                if(error.response && error.response.status === 403) {
                    alert("수정 권한이 없습니다.");
                } else {
                    alert("수정 처리 중 오류가 발생했습니다.");
                }
            });
    }
</script>

</body>
</html>