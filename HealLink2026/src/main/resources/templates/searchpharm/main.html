<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8"/>
    <title>HealLink - ì•½êµ­ ì°¾ê¸°</title>
    <link rel="stylesheet" th:href="@{/css/global.css}">
    <link rel="stylesheet" th:href="@{/css/mainpage/header.css}">
    <link rel="stylesheet" th:href="@{/css/mainpage/footer.css}">
    <link rel="stylesheet" th:href="@{/css/mainpage/content.css}">

    <style>
        /* 1. ì²˜ìŒì²˜ëŸ¼ ì•ˆì •ê°ì„ ì£¼ëŠ” ì»¨í…Œì´ë„ˆ ì„¤ì • */
        .pharmacy-container {
            width: 95%;
            max-width: 1200px;
            margin: 50px auto; /* ìƒë‹¨ ì—¬ë°± ë„‰ë„‰íˆ */
            text-align: center;
        }

        /* 2. ì œëª© ìŠ¤íƒ€ì¼ (ê²Œì‹œíŒê³¼ í†µì¼) */
        .page-title {
            font-weight: 700;
            color: #153f8f;
            font-size: 2.2rem;
            margin-bottom: 40px;
            text-align: center;
        }

        /* 3. ì§€ë„ì™€ íŒ¨ë„ì„ ê°ì‹¸ëŠ” ë©”ì¸ ì˜ì—­ */
        .main-content {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            height: 600px; /* ì´ˆê¸° ë†’ì´ ìœ ì§€ */
        }

        /* 4. ì§€ë„ ì˜ì—­ (ì´ˆê¸° êµ¬ì„±ì— ìŠ¤íƒ€ì¼ë§Œ ì‚´ì§ ë³´ì •) */
        #map-container {
            position: relative;
            flex: 2; /* ì§€ë„ ë¹„ìœ¨ */
            border: 1px solid #ddd;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        #map { width: 100%; height: 100%; }

        /* 5. ì‚¬ì´ë“œ íŒ¨ë„ */
        #side-panel {
            flex: 1; /* ë¦¬ìŠ¤íŠ¸ ë¹„ìœ¨ */
            display: flex;
            flex-direction: column;
            border: 1px solid #ddd;
            border-radius: 12px;
            background: #ffffff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            text-align: left;
            overflow: hidden;
        }

        /* ë°©ë¬¸ ì˜ˆì • ë³‘ì› ì„ íƒë°” (HealLink ë¸”ë£¨ í†¤ ì ìš©) */
        .reserved-hospital-box {
            padding: 15px;
            background: #f1f4f9;
            border-bottom: 1px solid #dee2e6;
        }
        .reserved-label {
            font-size: 13px;
            font-weight: bold;
            color: #153f8f;
            display: block;
            margin-bottom: 8px;
        }
        .hospital-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #adb5bd;
            border-radius: 6px;
            font-size: 14px;
            outline: none;
        }

        /* ë¦¬ìŠ¤íŠ¸ ë‚´ë¶€ ì˜ì—­ */
        #side-panel-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 0;
        }

        /* ë‚´ ìœ„ì¹˜ ë²„íŠ¼ */
        .my-location-btn {
            position: absolute; bottom: 20px; right: 20px; z-index: 10;
            padding: 0; background: #fff; border: 1px solid #ccc;
            border-radius: 50%; cursor: pointer; width: 45px; height: 45px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; transition: transform 0.2s;
        }
        .my-location-btn:hover { transform: scale(1.1); }

        /* ì¡°ì¤€ì  */
        .center-pointer {
            position: absolute; top: 50%; left: 50%;
            width: 24px; height: 24px;
            transform: translate(-50%, -50%);
            z-index: 10; pointer-events: none;
        }
        .center-pointer::before { content: ''; position: absolute; top: 11px; left: 0; width: 100%; height: 2px; background: rgba(21, 63, 143, 0.4); }
        .center-pointer::after { content: ''; position: absolute; top: 0; left: 11px; width: 2px; height: 100%; background: rgba(21, 63, 143, 0.4); }
    </style>
</head>
<body>

<div th:replace="~{mainpage/header :: header}"></div>

<div class="pharmacy-container">
    <h3 class="page-title">ğŸ’Š HealLink ì•½êµ­ ì°¾ê¸°</h3>
    <p class="page-subtitle" sec:authorize="isAnonymous()">
        ë¡œê·¸ì¸í•˜ì‹œë©´ ì˜ˆì•½í•˜ì‹  ë³‘ì› ê·¼ì²˜ì˜ ì•½êµ­ì„ ë” ë¹ ë¥´ê²Œ ì°¾ì•„ë“œë ¤ìš”.
    </p>

    <div class="main-content">
        <div id="map-container">
            <div id="map"
                 th:data-lat="${lat}"
                 th:data-lon="${lon}"
                 th:data-name="${hospitalName}"></div>
            <div class="center-pointer"></div>
            <button class="my-location-btn" onclick="moveToCurrentLocation()" title="ë‚´ ìœ„ì¹˜ë¡œ ì´ë™">ğŸ¯</button>
        </div>

        <div id="side-panel">
            <div th:if="${reservations != null and !reservations.isEmpty()}" class="reserved-hospital-box">
                <label class="reserved-label">ğŸ¥ ë°©ë¬¸ ì˜ˆì • ë³‘ì›</label>
                <select class="hospital-select" onchange="moveToReservedHospital(this.value)">
                    <option value="">-- ì£¼ë³€ ì•½êµ­ì„ ì°¾ì„ ë³‘ì› ì„ íƒ --</option>
                    <option th:each="res : ${reservations}"
                            th:value="${res.lat + '|' + res.lon + '|' + res.hospitalName}"
                            th:text="${res.hospitalName}">
                    </option>
                </select>
            </div>

            <div id="side-panel-content">
                <div style="padding: 40px; text-align: center;">
                    <h5 style="color: #dee2e6;">ì£¼ë³€ ì•½êµ­ ê²€ìƒ‰ ì¤‘...</h5>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{mainpage/footer :: footer}"></div>

<script type="text/javascript" th:src="|//dapi.kakao.com/v2/maps/sdk.js?appkey=${kakaoJsKey}&libraries=services&autoload=false|"></script>
<script th:src="@{/js/pharmacy-map.js}" charset="UTF-8"></script>

<script>
    window.onload = function() {
        if (typeof initPharmacyMap === 'function') initPharmacyMap();
    };
</script>

</body>
</html>